language: bash
dist: trusty
sudo: required
services:
- docker
script:
- |
  [ "${TRAVIS_BRANCH}" == "master" ] && [ "${TRAVIS_PULL_REQUEST}" == "false" ] &&\
  ! echo "${TRAVIS_COMMIT_MESSAGE}" | grep -- --no-deploy &&\
  sudo apt-get update -qq &&\
  sudo apt-get install -qqy curl gcc python-dev python-setuptools apt-transport-https \
                            lsb-release openssh-client git bash jq sshpass openssh-client &&\
  sudo easy_install -U pip &&\
  sudo pip install -U crcmod python-dotenv pyyaml &&\
  curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl &&\
  chmod +x ./kubectl &&\
  sudo mv ./kubectl /usr/local/bin/kubectl &&\
  openssl aes-256-cbc -K $encrypted_4fa8bbe6dd69_key -iv $encrypted_4fa8bbe6dd69_iv -in ./kamatera-secret.env.enc -out ./secret-kamatera.env -d &&\
  tests/run_all.sh
